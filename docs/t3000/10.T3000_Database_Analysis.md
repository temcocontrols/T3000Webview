# T3000 Database Schema Analysis and Comparison

## Summary of T3000 C++ Data Structures vs Current Database Schema

Based on the analysis of T3000 C++ source code and current database schema, here's a comprehensive comparison and recommended updates:

## 1. INPUT POINTS Comparison

### T3000 C++ Structure (`Str_in_point`):
```cpp
typedef struct {
    uint8_t description[21];     // Full Label
    uint8_t label[9];            // Label
    int value;                   // Value
    uint8_t filter;              // Filter
    uint8_t decom;               // Status (decommissioned)
    uint8_t sub_id;              // Panel (sub panel)
    uint8_t sub_product;         // Sub product
    uint8_t control;             // Control status
    uint8_t auto_manual;         // Auto/Man
    uint8_t digital_analog;      // Digital/Analog type
    uint8_t calibration_sign;    // Sign
    uint8_t sub_number;          // Sub number
    uint8_t calibration_h;       // Calibration high
    uint8_t calibration_l;       // Calibration low
    uint8_t range;               // Range
} Str_in_point;
```

### Your Reported Fields:
- Input, Panel, Full Label, Auto/Man, Value, Units, Range, Calibration, Sign, Filter, Status, Signal Type, Label, Type

### Current Database Schema:
```sql
CREATE TABLE input_points (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    device_id INTEGER NOT NULL,
    point_number INTEGER NOT NULL,
    label TEXT,
    description TEXT,
    units_type INTEGER DEFAULT 0,
    value REAL DEFAULT 0.0,
    range_min REAL DEFAULT 0.0,
    range_max REAL DEFAULT 100.0,
    calibration REAL DEFAULT 0.0,
    status INTEGER DEFAULT 0,
    filter INTEGER DEFAULT 0,
    decom INTEGER DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now')),
    updated_at INTEGER DEFAULT (strftime('%s', 'now'))
);
```

### **MISSING FIELDS IN DATABASE:**
- `panel_number` (from sub_id)
- `auto_manual` (Auto/Man field)
- `signal_type` (digital_analog field)
- `calibration_sign` (Sign field)
- `control_status` (control field)
- `sub_product` (sub product info)
- `range_type` (range as enumerated type vs min/max)

## 2. OUTPUT POINTS Comparison

### T3000 C++ Structure (`Str_out_point`):
```cpp
typedef struct {
    uint8_t description[21];     // Full Label
    uint8_t label[9];            // Label
    int32_t value;               // Value
    uint8_t auto_manual;         // Auto/Man
    uint8_t digital_analog;      // Digital/Analog
    uint8_t hw_switch_status;    // HOA Switch
    uint8_t control;             // Control
    uint8_t digital_control;     // Digital control
    uint8_t decom;               // Status
    uint8_t range;               // Range
    uint8_t sub_id;              // Panel (low voltage)
    uint8_t sub_product;         // Panel (high voltage)
    uint8_t sub_number;          // Sub number
    uint8_t pwm_period;          // PWM Period
} Str_out_point;
```

### Your Reported Fields:
- Output, Panel, Full Label, Auto/Man, HOA Switch, Value, Units, Range, Low V, High V, PWM Period, Status, Label, Type

### **MISSING FIELDS IN DATABASE:**
- `auto_manual` (Auto/Man field)
- `hoa_switch_status` (HOA Switch field)
- `signal_type` (digital_analog field)
- `panel_number` (from sub_id)
- `control_status` (control field)

## 3. VARIABLE POINTS Comparison

### T3000 C++ Structure (`Str_variable_point`):
```cpp
typedef struct {
    int8_t description[21];      // Full Label
    int8_t label[9];             // Label
    int32_t value;               // Value
    uint8_t auto_manual;         // Auto/Man
    uint8_t digital_analog;      // Digital/Analog
    uint8_t control;             // Control
    uint8_t unused;              // Unused
    uint8_t range;               // Range/Units
} Str_variable_point;
```

### Your Reported Fields:
- Variable, Full Label, Auto/Man, Value, Units, Label

### **MISSING FIELDS IN DATABASE:**
- `auto_manual` (Auto/Man field)

## 4. PROGRAM POINTS Comparison

### T3000 C++ Structure (`Str_program_point`):
```cpp
typedef struct {
    int8_t description[21];      // Full Label
    int8_t label[9];             // Label
    uint16_t bytes;              // Size
    uint8_t on_off;              // Status
    uint8_t auto_manual;         // Auto/Manual
    uint8_t com_prg;             // Communication program
    uint8_t errcode;             // Error code
    uint8_t unused;              // Unused
} Str_program_point;
```

### Your Reported Fields:
- Program, Full Label, Status, Auto/Manual, Size, Execution time, Label

### **MISSING FIELDS IN DATABASE:**
- `execution_time` field (not in C++ struct but you reported it)

## 5. PID CONTROLLERS Comparison

### T3000 C++ Structure (`Str_controller_point`):
```cpp
typedef struct {
    Point_T3000 input;           // Input point reference
    int32_t input_value;         // Input value
    int32_t value;               // Output value
    Point_T3000 setpoint;        // Setpoint point reference
    int32_t setpoint_value;      // Setpoint value
    uint8_t units;               // Units
    uint8_t auto_manual;         // A/M
    uint8_t action;              // Action (direct/reverse)
    uint8_t repeats_per_min;     // Repeats timing
    uint8_t sample_time;         // Sample time
    uint8_t prop_high;           // Proportional high bits
    uint8_t proportional;        // Prop
    uint8_t reset;               // Int
    uint8_t bias;                // Bias
    uint8_t rate;                // Der
} Str_controller_point;
```

### Your Reported Fields:
- NUM, Input, Value, Units, A/M, Output, Setpoint, Set Value, Units, Action, Prop, Int, Time, Der, Bias

### **MISSING FIELDS IN DATABASE:**
- `input_value` field
- `setpoint_value` field
- `output_value` (value field)
- `action` field (direct/reverse)
- `integral_time` (reset field)
- `derivative_time` (rate field)
- `sample_time` field

## 6. GRAPHICS/SCREENS

### No direct C++ structure found, but you reported:
- Graphic, Full Label, Label, Picture File, Element Count

### **COMPLETELY MISSING FROM DATABASE:**
Need to add `graphics` table with:
- `graphic_number`
- `full_label`
- `label`
- `picture_file`
- `element_count`

## 7. SCHEDULES Comparison

### T3000 C++ Structure (`Str_weekly_routine_point`):
```cpp
typedef struct {
    int8_t description[21];      // Full Label
    int8_t label[9];             // Label
    uint8_t value;               // Value/State
    uint8_t auto_manual;         // Auto/Manual
    uint8_t override_1_value;    // Override 1
    uint8_t override_2_value;    // Override 2
    uint8_t off;                 // Off state
    uint8_t unused;              // Unused
    Point_T3000 override_1;      // Override point 1
    Point_T3000 override_2;      // Override point 2
} Str_weekly_routine_point;
```

### Your Reported Fields:
- NUM, Full Label, Auto/Manual, Output, Holiday1, State1, Holiday2, State2, Label

### **MISSING FIELDS IN DATABASE:**
- `holiday1_reference`
- `state1_value`
- `holiday2_reference`
- `state2_value`

## 8. HOLIDAYS Comparison

### T3000 C++ Structure (`Str_annual_routine_point`):
```cpp
typedef struct {
    int8_t description[21];      // Full Label
    int8_t label[9];             // Label
    uint8_t value;               // Value
    uint8_t auto_manual;         // Auto/Manual
    uint8_t unused;              // Unused
} Str_annual_routine_point;
```

### Your Reported Fields:
- NUM, Full Label, Auto/Manual, Value, Label

### **CURRENT DATABASE IS ADEQUATE**

## 9. TREND LOGS

### Your Reported Fields:
- NUM, Label, Interval, Status, Data Size (KB)
- Sub-table: Num, Input

### **MISSING FIELDS IN DATABASE:**
- `data_size_kb` field in trendlogs table
- Need separate `trendlog_inputs` table for the sub-table relationship

## 10. ALARMS

### Your Reported Fields:
- NUM, Panel, Message, Time, Acknowledge, Res, Delete

### **MISSING FIELDS IN DATABASE:**
- `panel_number`
- `message` field
- `alarm_time`
- `acknowledge_status`
- `resolution_status`
- `delete_status`

## 11. ARRAYS

### Your Reported Fields:
- Item, Array Name, Length, Value

### **MISSING FROM DATABASE:**
Need to add `arrays` table and `array_values` table

## 12. NETWORK POINTS

### Your Reported Fields:
- Item, Main Panel, Device ID, Point number, Object instance, Type, Value, Status, Description, Last Contact

### **MISSING FROM DATABASE:**
Need to add `network_points` table

## 13. DEVICE INFORMATION

### Your Reported Fields:
- Module Number, Hardware version, MCU version, PIC version, Top version, Bootloader version, MCU type, SD Card Status
- Bacnet Instance, Serial Number, MAC Address, MSTP Network, Modbus RTU ID, BIP Network, Max master, Panel Number, Panel Name
- IP Address, Subnet Mask, Gateway Address, Modbus TCP Port
- RS485 SUB, Zigbee, RS485 Main, USB Port, Zigbee Pan ID

### **PARTIALLY COVERED:** Some fields exist in devices table, but many are missing

## 14. BUILDING INFORMATION

### Your Reported Fields:
- Selected, Building, Protocol, IP/Domain/Tel#/SerialNumber, Modbus TCP Port, COM Port, Baud Rate, Building Path

### **PARTIALLY COVERED:** Basic building info exists, but connection details are missing
